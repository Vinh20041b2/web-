const broker = "wss://e8fa3a03f84a4ba6ae0a38cb4c21a9e6.s1.eu.hivemq.cloud:8884/mqtt"; // URL TLS WebSocket
const topic = "esp/cambien"; 
const clientId = "webClient_" + Math.random().toString(16).substr(2, 8);

const username = "VINH1";  
const password = "Vinh2004";  // Cáº­p nháº­t Ä‘Ãºng máº­t kháº©u

const client = mqtt.connect(broker, {
    clientId: clientId,
    username: username,
    password: password,
    clean: true,
    connectTimeout: 4000,
    reconnectPeriod: 1000
});

client.on("connect", () => {
    console.log("ðŸŸ¢ Káº¿t ná»‘i MQTT thÃ nh cÃ´ng!");
    client.subscribe(topic, (err) => {
        if (!err) {
            console.log(`âœ… ÄÃ£ Ä‘Äƒng kÃ½ topic: ${topic}`);
        } else {
            console.log("âŒ Lá»—i khi Ä‘Äƒng kÃ½ topic!", err);
        }
    });
});

client.on("message", (topic, message) => {
    try {
        let data = JSON.parse(message.toString());
        console.log("ðŸ“© Dá»¯ liá»‡u nháº­n:", data);

        document.getElementById("humidity").innerText = data.sensor_doam + " %";
        document.getElementById("light").innerText = data.sensor_anhsang + " lux";
        document.getElementById("temperature").innerText = data.sensor_nhietdo + " Â°C";
        document.getElementById("soil-moisture").innerText = data.sensor_doamdat + " %";
    } catch (error) {
        console.error("âŒ Lá»—i xá»­ lÃ½ JSON:", error);
    }
});

client.on("error", (err) => {
    console.error("ðŸ”´ Lá»—i MQTT:", err);
});
